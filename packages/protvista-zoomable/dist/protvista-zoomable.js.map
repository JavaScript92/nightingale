{"version":3,"file":"protvista-zoomable.js","sources":["../src/protvista-zoomable.js","../src/main.js"],"sourcesContent":["import * as d3 from 'd3';\n\nclass ProtvistaZoomable extends HTMLElement {\n\n    constructor() {\n        super();\n        this.style.display = 'block';\n        this.style.width = '100%';\n        this.width = this.offsetWidth;\n\n        this._length = this.getAttribute('length') ? parseInt(this.getAttribute('length')) : 0;\n\n        this.displayStart = this.getAttribute('displaystart')\n            ? parseInt(this.getAttribute('displaystart'))\n            : 0;\n        this.displayEnd = this.getAttribute('displayEnd')\n            ? parseInt(this.getAttribute('displayEnd'))\n            : this.width;\n\n        this.updateScaleDomain = this.updateScaleDomain.bind(this);\n        this.initZoom = this.initZoom.bind(this);\n        this.zoomed = this.zoomed.bind(this);\n        this.applyZoomTranslation = this.applyZoomTranslation.bind(this);\n        this.listenForResize = this.listenForResize.bind(this);\n\n        this.updateScaleDomain();\n        this._originXScale = this.xScale.copy();\n        this.initZoom();\n        this.listenForResize();\n    }\n\n    get width() {\n        return this._width;\n    }\n\n    set width(width) {\n        this._width = width;\n    }\n\n    set length(length) {\n        this._length = length;\n    }\n\n    get length() {\n        return this._length;\n    }\n\n    get xScale() {\n        return this._xScale\n    }\n\n    set xScale(xScale) {\n        this._xScale = xScale;\n    }\n\n    get zoom() {\n        return this._zoom;\n    }\n\n    set svg(svg) {\n        this._svg = svg;\n        svg.call(this._zoom);\n        // this.applyZoomTranslation();\n    }\n\n    get svg() {\n        return this._svg;\n    }\n\n    updateScaleDomain() {\n        this.xScale = d3\n            .scaleLinear()\n            .domain([\n                1, this._length\n            ])\n            .range([\n                0, this._width\n            ]);\n    }\n\n    initZoom() {\n        this._zoom = d3.zoom()\n            .scaleExtent([1, 4])\n            .translateExtent([\n                [\n                    this.xScale(1), 0\n                ],\n                [this.width, 0]\n            ])\n            .on(\"zoom\", this.zoomed);\n    }\n\n    static get observedAttributes() {\n        return ['displaystart', 'displayend'];\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n        if (oldValue !== newValue) {\n            const value = parseFloat(newValue);\n            this[name] = isNaN(newValue) ? newValue : value;\n            this.applyZoomTranslation();\n        }\n    }\n\n    zoomed() {\n        this.xScale = d3.event\n                .transform\n                .rescaleX(this._originXScale);\n        this.refresh();\n\n        // If the source event is null the zoom wasn't initiated by this component, don't send event\n        if(!d3.event.sourceEvent) return;\n        this.dispatchEvent(new CustomEvent(\"change\", {\n            detail: { displayend: this.xScale.domain()[1], displaystart: this.xScale.domain()[0] }, bubbles: true, cancelable: true\n        }));\n    }\n\n    applyZoomTranslation() {\n        if (!this.svg) return;\n        const k = this.width / (this.xScale(this.displayEnd) - this.xScale(this.displayStart));\n        this\n            .svg\n            .transition()\n            .duration(300)\n            .call(this.zoom.transform, d3.zoomIdentity.scale(k).translate(-this.xScale(this.displayStart), 0));\n    }\n\n    listenForResize() {\n        // TODO add sleep to make transition appear smoother. Could experiment with CSS3\n        // transitions too\n        window.onresize = () => {\n            this.width = this\n                .offsetWidth;\n            //TODO trigger repaint here\n        };\n    }\n\n}\n\nexport default ProtvistaZoomable;","import ProtvistaZoomable from './protvista-zoomable';\n\nconst loadComponent = function() {\n    customElements.define('protvista-zoomable', ProtvistaZoomable);\n};\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document.addEventListener('WebComponentsReady', function() {\n        loadComponent();\n    });\n}\n\nexport default ProtvistaZoomable;"],"names":["ProtvistaZoomable","style","display","width","offsetWidth","_length","getAttribute","parseInt","displayStart","displayEnd","updateScaleDomain","bind","initZoom","zoomed","applyZoomTranslation","listenForResize","_originXScale","xScale","copy","d3","domain","range","_width","_zoom","scaleExtent","translateExtent","on","name","oldValue","newValue","value","parseFloat","isNaN","transform","rescaleX","refresh","sourceEvent","dispatchEvent","CustomEvent","displayend","displaystart","bubbles","cancelable","svg","k","transition","duration","call","zoom","scale","translate","onresize","length","_xScale","_svg","HTMLElement","loadComponent","define","window","customElements","addEventListener"],"mappings":"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"}