{"version":3,"file":"index.js","sources":["../src/protvista-navigation.js","../src/index.js"],"sourcesContent":["import {\n  scaleLinear,\n  axisBottom,\n  brushX,\n  format,\n  select,\n  event as d3Event\n} from 'd3';\n\nconst height = 40,\n  padding = {\n    top: 10,\n    right: 10,\n    bottom: 10,\n    left: 10\n  };\n\nclass ProtVistaNavigation extends HTMLElement {\n  constructor() {\n    super();\n    this._x = null;\n    this.dontDispatch = false;\n  }\n\n  connectedCallback() {\n    this.style.display = 'block';\n    this.style.width = '100%';\n    this.width = this.offsetWidth;\n\n    this._length = parseFloat(this.getAttribute('length'));\n    this._displaystart = parseFloat(this.getAttribute('displaystart')) || 1;\n    this._displayend = parseFloat(this.getAttribute('displayend')) || this._length;\n    this._highlightStart = parseFloat(this.getAttribute('highlightStart'));\n    this._highlightEnd = parseFloat(this.getAttribute('highlightEnd'));\n\n    this._onResize = this._onResize.bind(this);\n\n    this._createNavRuler();\n  }\n\n  disconnectedCallback() {\n    if (this._ro) {\n      this._ro.unobserve(this);\n    } else {\n      window.removeEventListener(this._onResize);\n    }\n  }\n\n  static get observedAttributes() {return [\n    'length', 'displaystart', 'displayend', 'highlightStart', 'highlightEnd', 'width'\n  ]; }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (oldValue !== newValue){\n      this[`_${name}`] = parseFloat(newValue);\n      this._updateNavRuler();\n    }\n  }\n  get width() {\n      return this._width;\n  }\n\n  set width(width) {\n      this._width = width;\n  }\n\n  get isManaged() {\n    return true;\n  }\n\n  _createNavRuler() {\n    this._x = scaleLinear().range([padding.left, this.width - padding.right]);\n    this._x.domain([1, this._length]);\n\n    this._svg = select(this)\n      .append('div')\n      .attr('class', '')\n      .append('svg')\n      .attr('id', '')\n      .attr('width', this.width)\n      .attr('height', (height));\n\n    this._xAxis = axisBottom(this._x);\n\n    this._displaystartLabel = this._svg.append(\"text\")\n                        .attr('class', 'start-label')\n                        .attr('x', 0)\n                        .attr('y', height - padding.bottom);\n\n    this._displayendLabel = this._svg.append(\"text\")\n                      .attr('class', 'end-label')\n                      .attr('x', this.width)\n                      .attr('y', height - padding.bottom)\n                      .attr('text-anchor', 'end');\n    this._axis = this._svg.append('g')\n      .attr('class', 'x axis')\n      .call(this._xAxis);\n\n    this._viewport = brushX().extent([\n        [padding.left, 0],\n        [(this.width - padding.right), height*0.51]\n      ])\n      .on(\"brush\", () => {\n        if (d3Event.selection){\n          this._displaystart = format(\"d\")(this._x.invert(d3Event.selection[0]));\n          this._displayend = format(\"d\")(this._x.invert(d3Event.selection[1]));\n          if (!this.dontDispatch)\n            this.dispatchEvent(new CustomEvent(\"change\", {\n              detail: {\n                displayend: this._displayend, displaystart: this._displaystart,\n                extra: {transform: d3Event.transform}\n              }, bubbles:true, cancelable: true\n            }));\n          this._updateLabels();\n          this._updatePolygon();\n        }\n      });\n\n    this._brushG = this._svg.append(\"g\")\n      .attr(\"class\", \"brush\")\n      .call(this._viewport);\n\n    this._brushG\n      .call(this._viewport.move, [this._x(this._displaystart), this._x(this._displayend)]);\n\n    this.polygon = this._svg.append(\"polygon\")\n      .attr('class', 'zoom-polygon')\n      .attr('fill', '#777')\n      .attr('fill-opacity','0.3');\n    this._updateNavRuler();\n\n    if ('ResizeObserver' in window) {\n      this._ro = new ResizeObserver(this._onResize);\n      this._ro.observe(this);\n    }\n    window.addEventListener(\"resize\", this._onResize);\n  }\n\n  _onResize() {\n    this.width = this.offsetWidth;\n    this._x = this._x.range([padding.left, this.width - padding.right]);\n    this._svg.attr('width', this.width);\n    this._axis.call(this._xAxis);\n    this._viewport.extent([\n        [padding.left, 0],\n        [(this.width - padding.right), height*0.51]\n      ])\n    this._brushG.call(this._viewport);\n    this._updateNavRuler();\n  }\n\n  _updateNavRuler(){\n    if (this._x){\n      this._updatePolygon();\n      this._updateLabels();\n      if (this._brushG) {\n        this.dontDispatch = true;\n        this._brushG\n          .call(this._viewport.move, [this._x(this._displaystart), this._x(this._displayend)]);\n        this.dontDispatch = false;\n      }\n    }\n  }\n  _updateLabels() {\n    if (this._displaystartLabel) this._displaystartLabel.text(this._displaystart);\n    if (this._displayendLabel)\n      this._displayendLabel\n        .attr('x', this.width)\n        .text(this._displayend);\n  }\n  _updatePolygon(){\n    if (this.polygon) this.polygon\n      .attr('points',\n        `${this._x(this._displaystart)},${height/2}\n        ${this._x(this._displayend)},${height/2}\n        ${this.width},${height}\n        0,${height}`\n      );\n  }\n}\n\nexport default ProtVistaNavigation;\n","import ProtVistaNavigation from './protvista-navigation';\n\nconst loadComponent = function() {\n  customElements.define('protvista-navigation', ProtVistaNavigation);\n};\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document.addEventListener('WebComponentsReady', function() {\n        loadComponent();\n    });\n}\n\nexport default ProtVistaNavigation;\n"],"names":["height","padding","top","right","bottom","left","ProtVistaNavigation","HTMLElement","constructor","_x","dontDispatch","connectedCallback","style","display","width","offsetWidth","_length","parseFloat","getAttribute","_displaystart","_displayend","_highlightStart","_highlightEnd","_onResize","bind","_createNavRuler","disconnectedCallback","_ro","unobserve","window","removeEventListener","observedAttributes","attributeChangedCallback","name","oldValue","newValue","_updateNavRuler","_width","isManaged","scaleLinear","range","domain","_svg","select","append","attr","_xAxis","axisBottom","_displaystartLabel","_displayendLabel","_axis","call","_viewport","brushX","extent","on","d3Event","selection","format","invert","dispatchEvent","CustomEvent","detail","displayend","displaystart","extra","transform","bubbles","cancelable","_updateLabels","_updatePolygon","_brushG","move","polygon","ResizeObserver","observe","addEventListener","text","loadComponent","customElements","define","document"],"mappings":"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"}