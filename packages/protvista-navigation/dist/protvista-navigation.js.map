{"version":3,"file":"protvista-navigation.js","sources":["../src/protvista-navigation.js","../src/index.js"],"sourcesContent":["import * as d3 from \"d3\";\n\nconst height = 40,\n  // width = 760,\n  padding = {\n    top: 10,\n    right: 10,\n    bottom: 10,\n    left: 10\n  };\n\nclass ProtVistaNavigation extends HTMLElement {\n\n  constructor() {\n    super();\n    this.style.display = 'block';\n    this.style.width = '100%';\n    this.width = this.offsetWidth;\n\n    this._length = parseFloat(this.getAttribute('length'));\n    this._displaystart = parseFloat(this.getAttribute('displaystart')) || 1;\n    this._displayend = parseFloat(this.getAttribute('displayend')) || this._length;\n    this._highlightStart = parseFloat(this.getAttribute('highlightStart'));\n    this._highlightEnd = parseFloat(this.getAttribute('highlightEnd'));\n  }\n\n  connectedCallback() {\n    this._createNavRuler();\n  }\n\n  static get observedAttributes() {return [\n    'length', 'displaystart', 'displayend', 'highlightStart', 'highlightEnd', 'width'\n  ]; }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (oldValue !== newValue){\n      this[`_${name}`] = parseFloat(newValue);\n      this._updateNavRuler();\n    }\n  }\n  get width() {\n      return this._width;\n  }\n\n  set width(width) {\n      this._width = width;\n  }\n\n  _createNavRuler() {\n    this._x = d3.scaleLinear().range([padding.left, this.width - padding.right]);\n    this._x.domain([1, this._length]);\n\n    const svg = d3.select(this)\n      .append('div')\n      .attr('class', '')\n      .append('svg')\n      .attr('id', '')\n      .attr('width', this.width)\n      .attr('height', (height));\n\n    const xAxis = d3.axisBottom(this._x);\n\n    this._displaystartLabel = svg.append(\"text\")\n                        .attr('class', 'start-label')\n                        .attr('x', 0)\n                        .attr('y', height - padding.bottom);\n\n    this._displayendLabel = svg.append(\"text\")\n                      .attr('class', 'end-label')\n                      .attr('x', this.width)\n                      .attr('y', height - padding.bottom)\n                      .attr('text-anchor', 'end');\n    svg.append('g')\n      .attr('class', 'x axis')\n      .call(xAxis);\n\n    this._viewport = d3.brushX().extent([\n        [padding.left, 0],\n        [(this.width - padding.right), height*0.51]\n      ])\n      .on(\"brush\", () => {\n        if (d3.event.selection){\n          this._displaystart = d3.format(\"d\")(this._x.invert(d3.event.selection[0]));\n          this._displayend = d3.format(\"d\")(this._x.invert(d3.event.selection[1]));\n          this.dispatchEvent(new CustomEvent(\"change\", {\n            detail: {\n              displayend: this._displayend, displaystart: this._displaystart,\n              extra: {transform: d3.event.transform}\n            }, bubbles:true, cancelable: true\n          }));\n          this._updateLabels();\n          this._updatePolygon();\n        }\n      });\n\n    this._brushG = svg.append(\"g\")\n      .attr(\"class\", \"brush\")\n      .call(this._viewport);\n\n    this._brushG\n      .call(this._viewport.move, [this._x(this._displaystart), this._x(this._displayend)]);\n\n    this.polygon = svg.append(\"polygon\")\n      .attr('class', 'zoom-polygon')\n      .attr('fill', '#777')\n      .attr('fill-opacity','0.3');\n    this._updateNavRuler();\n  }\n  _updateNavRuler(){\n    this._updatePolygon();\n    this._updateLabels();\n    if (this._brushG) this._brushG\n      .call(this._viewport.move, [this._x(this._displaystart), this._x(this._displayend)]);\n  }\n  _updateLabels() {\n    if (this._displaystartLabel) this._displaystartLabel.text(this._displaystart);\n    if (this._displayendLabel) this._displayendLabel.text(this._displayend);\n  }\n  _updatePolygon(){\n    if (this.polygon) this.polygon\n      .attr('points',\n        `${this._x(this._displaystart)},${height/2}\n        ${this._x(this._displayend)},${height/2}\n        ${this.width-padding.right},${height}\n        ${padding.left},${height}`\n      );\n  }\n}\n\nexport default ProtVistaNavigation;\n","import ProtVistaNavigation from './protvista-navigation';\n\nconst loadComponent = function() {\n  customElements.define('protvista-navigation', ProtVistaNavigation);\n};\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document.addEventListener('WebComponentsReady', function() {\n        loadComponent();\n    });\n}\n\nexport default ProtVistaNavigation;\n"],"names":["height","padding","ProtVistaNavigation","style","display","width","offsetWidth","_length","parseFloat","getAttribute","_displaystart","_displayend","_highlightStart","_highlightEnd","_createNavRuler","name","oldValue","newValue","_updateNavRuler","_x","d3","range","left","right","domain","svg","append","attr","xAxis","_displaystartLabel","bottom","_displayendLabel","call","_viewport","extent","on","selection","invert","dispatchEvent","CustomEvent","displaystart","transform","bubbles","cancelable","_updateLabels","_updatePolygon","_brushG","move","polygon","text","_width","HTMLElement","loadComponent","define","window","customElements","addEventListener"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,SAAS,EAAf;IAEEC,UAAU;OACH,EADG;SAED,EAFC;UAGA,EAHA;QAIF;CANV;;IASMC;;;iCAEU;;;;;UAEPC,KAAL,CAAWC,OAAX,GAAqB,OAArB;UACKD,KAAL,CAAWE,KAAX,GAAmB,MAAnB;UACKA,KAAL,GAAa,MAAKC,WAAlB;;UAEKC,OAAL,GAAeC,WAAW,MAAKC,YAAL,CAAkB,QAAlB,CAAX,CAAf;UACKC,aAAL,GAAqBF,WAAW,MAAKC,YAAL,CAAkB,cAAlB,CAAX,KAAiD,CAAtE;UACKE,WAAL,GAAmBH,WAAW,MAAKC,YAAL,CAAkB,YAAlB,CAAX,KAA+C,MAAKF,OAAvE;UACKK,eAAL,GAAuBJ,WAAW,MAAKC,YAAL,CAAkB,gBAAlB,CAAX,CAAvB;UACKI,aAAL,GAAqBL,WAAW,MAAKC,YAAL,CAAkB,cAAlB,CAAX,CAArB;;;;;;wCAGkB;WACbK,eAAL;;;;6CAOuBC,MAAMC,UAAUC,UAAU;UAC7CD,aAAaC,QAAjB,EAA0B;mBACfF,IAAT,IAAmBP,WAAWS,QAAX,CAAnB;aACKC,eAAL;;;;;sCAWc;;;WACXC,EAAL,GAAUC,cAAA,GAAiBC,KAAjB,CAAuB,CAACpB,QAAQqB,IAAT,EAAe,KAAKjB,KAAL,GAAaJ,QAAQsB,KAApC,CAAvB,CAAV;WACKJ,EAAL,CAAQK,MAAR,CAAe,CAAC,CAAD,EAAI,KAAKjB,OAAT,CAAf;;UAEMkB,MAAML,SAAA,CAAU,IAAV,EACTM,MADS,CACF,KADE,EAETC,IAFS,CAEJ,OAFI,EAEK,EAFL,EAGTD,MAHS,CAGF,KAHE,EAITC,IAJS,CAIJ,IAJI,EAIE,EAJF,EAKTA,IALS,CAKJ,OALI,EAKK,KAAKtB,KALV,EAMTsB,IANS,CAMJ,QANI,EAMO3B,MANP,CAAZ;;UAQM4B,QAAQR,aAAA,CAAc,KAAKD,EAAnB,CAAd;;WAEKU,kBAAL,GAA0BJ,IAAIC,MAAJ,CAAW,MAAX,EACLC,IADK,CACA,OADA,EACS,aADT,EAELA,IAFK,CAEA,GAFA,EAEK,CAFL,EAGLA,IAHK,CAGA,GAHA,EAGK3B,SAASC,QAAQ6B,MAHtB,CAA1B;;WAKKC,gBAAL,GAAwBN,IAAIC,MAAJ,CAAW,MAAX,EACLC,IADK,CACA,OADA,EACS,WADT,EAELA,IAFK,CAEA,GAFA,EAEK,KAAKtB,KAFV,EAGLsB,IAHK,CAGA,GAHA,EAGK3B,SAASC,QAAQ6B,MAHtB,EAILH,IAJK,CAIA,aAJA,EAIe,KAJf,CAAxB;UAKID,MAAJ,CAAW,GAAX,EACGC,IADH,CACQ,OADR,EACiB,QADjB,EAEGK,IAFH,CAEQJ,KAFR;;WAIKK,SAAL,GAAiBb,SAAA,GAAYc,MAAZ,CAAmB,CAChC,CAACjC,QAAQqB,IAAT,EAAe,CAAf,CADgC,EAEhC,CAAE,KAAKjB,KAAL,GAAaJ,QAAQsB,KAAvB,EAA+BvB,SAAO,IAAtC,CAFgC,CAAnB,EAIdmC,EAJc,CAIX,OAJW,EAIF,YAAM;YACbf,QAAA,CAASgB,SAAb,EAAuB;iBAChB1B,aAAL,GAAqBU,SAAA,CAAU,GAAV,EAAe,OAAKD,EAAL,CAAQkB,MAAR,CAAejB,QAAA,CAASgB,SAAT,CAAmB,CAAnB,CAAf,CAAf,CAArB;iBACKzB,WAAL,GAAmBS,SAAA,CAAU,GAAV,EAAe,OAAKD,EAAL,CAAQkB,MAAR,CAAejB,QAAA,CAASgB,SAAT,CAAmB,CAAnB,CAAf,CAAf,CAAnB;iBACKE,aAAL,CAAmB,IAAIC,WAAJ,CAAgB,QAAhB,EAA0B;oBACnC;0BACM,OAAK5B,WADX,EACwB6B,cAAc,OAAK9B,aAD3C;qBAEC,EAAC+B,WAAWrB,QAAA,CAASqB,SAArB;aAHkC,EAIxCC,SAAQ,IAJgC,EAI1BC,YAAY;WAJZ,CAAnB;iBAMKC,aAAL;iBACKC,cAAL;;OAfW,CAAjB;;WAmBKC,OAAL,GAAerB,IAAIC,MAAJ,CAAW,GAAX,EACZC,IADY,CACP,OADO,EACE,OADF,EAEZK,IAFY,CAEP,KAAKC,SAFE,CAAf;;WAIKa,OAAL,CACGd,IADH,CACQ,KAAKC,SAAL,CAAec,IADvB,EAC6B,CAAC,KAAK5B,EAAL,CAAQ,KAAKT,aAAb,CAAD,EAA8B,KAAKS,EAAL,CAAQ,KAAKR,WAAb,CAA9B,CAD7B;;WAGKqC,OAAL,GAAevB,IAAIC,MAAJ,CAAW,SAAX,EACZC,IADY,CACP,OADO,EACE,cADF,EAEZA,IAFY,CAEP,MAFO,EAEC,MAFD,EAGZA,IAHY,CAGP,cAHO,EAGQ,KAHR,CAAf;WAIKT,eAAL;;;;sCAEe;WACV2B,cAAL;WACKD,aAAL;UACI,KAAKE,OAAT,EAAkB,KAAKA,OAAL,CACfd,IADe,CACV,KAAKC,SAAL,CAAec,IADL,EACW,CAAC,KAAK5B,EAAL,CAAQ,KAAKT,aAAb,CAAD,EAA8B,KAAKS,EAAL,CAAQ,KAAKR,WAAb,CAA9B,CADX;;;;oCAGJ;UACV,KAAKkB,kBAAT,EAA6B,KAAKA,kBAAL,CAAwBoB,IAAxB,CAA6B,KAAKvC,aAAlC;UACzB,KAAKqB,gBAAT,EAA2B,KAAKA,gBAAL,CAAsBkB,IAAtB,CAA2B,KAAKtC,WAAhC;;;;qCAEb;UACV,KAAKqC,OAAT,EAAkB,KAAKA,OAAL,CACfrB,IADe,CACV,QADU,EAEX,KAAKR,EAAL,CAAQ,KAAKT,aAAb,CAFW,SAEoBV,SAAO,CAF3B,kBAGZ,KAAKmB,EAAL,CAAQ,KAAKR,WAAb,CAHY,SAGiBX,SAAO,CAHxB,mBAIZ,KAAKK,KAAL,GAAWJ,QAAQsB,KAJP,UAIgBvB,MAJhB,kBAKZC,QAAQqB,IALI,SAKItB,MALJ;;;;2BA/ER;aACD,KAAKkD,MAAZ;;yBAGM7C,OAAO;WACR6C,MAAL,GAAc7C,KAAd;;;;2BAf4B;aAAQ,CACtC,QADsC,EAC5B,cAD4B,EACZ,YADY,EACE,gBADF,EACoB,cADpB,EACoC,OADpC,CAAP;;;;EAnBD8C,aAsHlC;;AC/HA,IAAMC,gBAAgB,SAAhBA,aAAgB,GAAW;mBAChBC,MAAf,CAAsB,sBAAtB,EAA8CnD,qBAA9C;CADF;;;AAKA,IAAIoD,OAAOC,cAAX,EAA2B;;CAA3B,MAEO;aACMC,gBAAT,CAA0B,oBAA1B,EAAgD,YAAW;;KAA3D;CAKJ;;;;"}