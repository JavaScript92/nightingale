{"version":3,"file":"index.js","sources":["../src/protvista-sequence.js","../src/index.js"],"sourcesContent":["import {\n  axisBottom,\n  select,\n} from 'd3';\n\nimport ProtvistaZoomable from 'protvista-zoomable';\n\nconst height = 40;\n\nclass ProtVistaSequence extends ProtvistaZoomable {\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._highlightstart = parseInt(this.getAttribute('highlightstart'));\n    this._highlightend = parseInt(this.getAttribute('highlightend'));\n    if (this.sequence) {\n      this._createSequence();\n    }\n  }\n\n  get data() {\n    return this.sequence;\n  }\n\n  set data(data) {\n    if (typeof data === 'string')\n      this.sequence = data;\n    else if ('sequence' in data)\n      this.sequence = data.sequence;\n\n    if (this.sequence)\n      this._createSequence();\n  }\n\n\n\n  _createSequence() {\n    super.svg = select(this)\n      .append('div')\n      .attr('class', '')\n      .append('svg')\n      .attr('id', '')\n      .attr('width', this.width)\n      .attr('height', (height));\n\n    this.seq_bg = super.svg.append('g')\n      .attr('class', 'background');\n\n    this.axis = super.svg.append('g')\n      .attr('class', 'x axis');\n\n    this.seq_g = super.svg.append('g')\n      .attr('class', 'sequence')\n      .attr('transform', `translate(0,${0.75*height})`);\n\n    this.highlighted = super.svg.append('rect')\n      .attr('class', 'highlighted')\n      .attr('fill', 'yellow')\n      .attr('height', height);\n\n    this.refresh();\n  }\n\n  refresh(){\n    if (this.axis) {\n      const ftWidth = this.xScale(2)-this.xScale(1);\n      const half = ftWidth/2;\n      this.xAxis = axisBottom(this.xScale)\n        .tickFormat(d => Number.isInteger(d) ? d : '');\n      this.axis.call(this.xAxis);\n\n      this.axis.attr(\"transform\", `translate(${half},0)`)\n      this.axis.select('.domain').remove();\n      this.axis.selectAll('.tick line').remove();\n\n      this.bases = this.seq_g.selectAll('text.base')\n        .data(this.sequence.split(''));\n      this.bases.enter()\n        .append('text')\n        .attr('class', 'base')\n        .attr('text-anchor', 'middle')\n        .attr('x', (b,i) => (this.xScale(i+1)+half))\n        .text(d=>d)\n        .attr('style','font-family:monospace');\n      this.bases.attr('x', (b,i) => (this.xScale(i+1)+half));\n\n      this.background = this.seq_bg.selectAll('rect.base_bg')\n        .data(this.sequence.split(''));\n      this.background.enter()\n        .append('rect')\n        .attr('class', 'base_bg')\n        .attr('fill', (d,i) => i%2 ? '#ccc': '#eee')\n        .attr('height', height)\n        .attr('width', ftWidth)\n        .attr('x', (b,i) => this.xScale(i+1));\n      this.background\n        .attr('width', ftWidth)\n        .attr('x', (b,i) => this.xScale(i+1));\n\n      const space = super.xScale(2) - super.xScale(1)\n        - this.seq_g.select('text.base').node().getBBox().width * 0.8;\n      this.seq_g.style('opacity', Math.min(1, space));\n      this.background.style('opacity', Math.min(1, space));\n\n      if (Number.isInteger(this._highlightstart) && Number.isInteger(this._highlightend)){\n        this.highlighted\n          .attr('x', super.xScale(this._highlightstart))\n          .style('opacity', 0.3)\n          .attr('width', ftWidth*\n            (this._highlightend - this._highlightstart + 1)\n          );\n      } else {\n        this.highlighted.style('opacity', 0);\n      }\n    }\n  }\n}\n\n\nexport default ProtVistaSequence;\n","import ProtVistaSequence from './protvista-sequence';\n\nconst loadComponent = function() {\n  customElements.define('protvista-sequence', ProtVistaSequence);\n};\n\n// Conditional loading of polyfill\nif (window.customElements) {\n    loadComponent();\n} else {\n    document.addEventListener('WebComponentsReady', function() {\n        loadComponent();\n    });\n}\n\nexport default ProtVistaSequence;\n"],"names":["height","ProtVistaSequence","ProtvistaZoomable","connectedCallback","_highlightstart","parseInt","getAttribute","_highlightend","sequence","_createSequence","data","svg","select","append","attr","width","seq_bg","axis","seq_g","highlighted","refresh","ftWidth","xScale","half","xAxis","axisBottom","tickFormat","d","Number","isInteger","call","remove","selectAll","bases","split","enter","b","i","text","background","space","node","getBBox","style","Math","min","loadComponent","customElements","define","window","document","addEventListener"],"mappings":"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"}